				<div class="untree_co-section">
		    <div class="container">		      
		      <div class="row">
		        <div class="col-md-6 mb-5 mb-md-0">
		          <h2 class="h3 mb-3 text-black">Billing Details</h2>
		          <div class="p-3 p-lg-5 border bg-white">
		            <div class="form-group">
		              <label for="c_country" class="text-black">Country <span class="text-danger">*</span></label>
		              <select id="c_country" class="form-control">
		                <option value="1">Select a country</option>    
		                <option value="2">bangladesh</option>    
		                <option value="3">Algeria</option>    
		                <option value="4">Afghanistan</option>    
		                <option value="5">Ghana</option>    
		                <option value="6">Albania</option>    
		                <option value="7">Bahrain</option>    
		                <option value="8">Colombia</option>    
		                <option value="9">Dominican Republic</option>    
		              </select>
		            </div>
		            <div class="form-group row">
		              <div class="col-md-6">
		                <label for="c_fname" class="text-black">First Name <span class="text-danger">*</span></label>
		                <input type="text" class="form-control" id="c_fname" name="c_fname">
		              </div>
		              <div class="col-md-6">
		                <label for="c_lname" class="text-black">Last Name <span class="text-danger">*</span></label>
		                <input type="text" class="form-control" id="c_lname" name="c_lname">
		              </div>
		            </div>

		            <div class="form-group row">
		              <div class="col-md-12">
		                <label for="c_companyname" class="text-black">Company Name </label>
		                <input type="text" class="form-control" id="c_companyname" name="c_companyname">
		              </div>
		            </div>

		            <div class="form-group row">
		              <div class="col-md-12">
		                <label for="c_address" class="text-black">Address <span class="text-danger">*</span></label>
		                <input type="text" class="form-control" id="c_address" name="c_address" placeholder="Street address">
		              </div>
		            </div>

		            <div class="form-group mt-3">
		              <input type="text" class="form-control" placeholder="Apartment, suite, unit etc. (optional)">
		            </div>

		            <div class="form-group row">
		              <div class="col-md-6">
		                <label for="c_state_country" class="text-black">State / Country <span class="text-danger">*</span></label>
		                <input type="text" class="form-control" id="c_state_country" name="c_state_country">
		              </div>
		              <div class="col-md-6">
		                <label for="c_postal_zip" class="text-black">Posta / Zip <span class="text-danger">*</span></label>
		                <input type="text" class="form-control" id="c_postal_zip" name="c_postal_zip">
		              </div>
		            </div>

		            <div class="form-group row mb-5">
		              <div class="col-md-6">
		                <label for="c_email_address" class="text-black">Email Address <span class="text-danger">*</span></label>
		                <input type="text" class="form-control" id="c_email_address" name="c_email_address">
		              </div>
		              <div class="col-md-6">
		                <label for="c_phone" class="text-black">Phone <span class="text-danger">*</span></label>
		                <input type="text" class="form-control" id="c_phone" name="c_phone" placeholder="Phone Number">
		              </div>
		            </div>

		          </div>
		        </div>
		        <div class="col-md-6">

		          <div class="row mb-5">
		            <div class="col-md-12">
		              <h2 class="h3 mb-3 text-black">Coupon Code</h2>
		              <div class="p-3 p-lg-5 border bg-white">

		                <label for="c_code" class="text-black mb-3">Enter your coupon code if you have one</label>
		                <div class="input-group w-75 couponcode-wrap">
		                  <input type="text" class="form-control me-2" id="c_code" placeholder="Coupon Code" aria-label="Coupon Code" aria-describedby="button-addon2">
		                  <div class="input-group-append">
		                    <button class="btn btn-black btn-sm" type="button" id="button-addon2">Apply</button>
		                  </div>
		                </div>

		              </div>
		            </div>
		          </div>

		          <div class="row mb-5">
		            <div class="col-md-12">
		              <h2 class="h3 mb-3 text-black">Your Order</h2>
		              <div class="p-3 p-lg-5 border bg-white">
		                <table class="table site-block-order-table mb-5">
		                  <thead>
		                    <th>Product</th>
		                    <th>Total</th>
		                  </thead>
		                  <tbody id="checkout-order-items">
		                    <!-- Cart items will be loaded here dynamically -->
		                    <tr id="loading-order">
		                      <td colspan="2" class="text-center py-3">
		                        <div class="spinner-border spinner-border-sm" role="status">
		                          <span class="visually-hidden">Loading...</span>
		                        </div>
		                        Loading your order...
		                      </td>
		                    </tr>
		                    <tr>
		                      <td class="text-black font-weight-bold"><strong>Cart Subtotal</strong></td>
		                      <td class="text-black" id="checkout-subtotal">$0.00</td>
		                    </tr>
		                    <tr>
		                      <td class="text-black font-weight-bold"><strong>Order Total</strong></td>
		                      <td class="text-black font-weight-bold"><strong id="checkout-total">$0.00</strong></td>
		                    </tr>
		                  </tbody>
		                </table>

		                

		                <div class="border p-3 mb-5">
		                  <h3 class="h6 mb-0"><a class="d-block" data-bs-toggle="collapse" href="#collapsepaypal" role="button" aria-expanded="false" aria-controls="collapsepaypal">Paypal</a></h3>

		                  <div class="collapse" id="collapsepaypal">
		                    <div class="py-2">
		                      <p class="mb-0">Make your payment directly into our bank account. Please use your Order ID as the payment reference. Your order won't be shipped until the funds have cleared in our account.</p>
		                    </div>
		                  </div>
		                </div>

		                <div class="form-group">
		                  <button class="btn btn-black btn-lg py-3 btn-block" id="place-order-btn">Place Order</button>
		                </div>

		              </div>
		            </div>
		          </div>

		        </div>
		      </div>
		      <!-- </form> -->
		    </div>
		  </div>

		<!-- Order Success Modal -->
		<div class="modal fade" id="orderSuccessModal" tabindex="-1" aria-labelledby="orderSuccessModalLabel" aria-hidden="true">
		  <div class="modal-dialog modal-lg">
		    <div class="modal-content">
		      <div class="modal-header bg-success text-white">
		        <h5 class="modal-title" id="orderSuccessModalLabel">
		          <i class="fa fa-check-circle me-2"></i>Order Placed Successfully!
		        </h5>
		        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
		      </div>
		      <div class="modal-body">
		        <div class="text-center mb-4">
		          <i class="fa fa-check-circle text-success" style="font-size: 4rem;"></i>
		          <h4 class="mt-3">Thank you for your order!</h4>
		          <p class="text-muted">Your order has been placed successfully and is being processed.</p>
		        </div>
		        
		        <div class="order-details">
		          <h6>Order Details:</h6>
		          <div class="row">
		            <div class="col-md-6">
		              <p><strong>Order ID:</strong> <span id="order-id"></span></p>
		              <p><strong>Status:</strong> <span id="order-status" class="badge bg-warning">Pending</span></p>
		            </div>
		            <div class="col-md-6">
		              <p><strong>Total Amount:</strong> <span id="order-total"></span></p>
		              <p><strong>Order Date:</strong> <span id="order-date"></span></p>
		            </div>
		          </div>
		        </div>
		        
		        <div class="order-items mt-3">
		          <h6>Items Ordered:</h6>
		          <div id="order-items-list">
		            <!-- Order items will be populated here -->
		          </div>
		        </div>
		      </div>
		      <div class="modal-footer justify-content-center">
		        <button type="button" class="btn btn-primary btn-lg px-5" id="back-to-store-btn">Back to Store</button>
		      </div>
		    </div>
		  </div>
		</div>

<script>
$(document).ready(function() {
    // Load checkout order summary when page loads
    loadCheckoutOrder();
    
    // Auto-reload when page becomes visible (when navigating to checkout)
    $(document).on('spapp.pageshow', function(event, data) {
        if (data && data.route === '#checkout') {
            console.log('Checkout page activated, refreshing order summary');
            loadCheckoutOrder();
        }
    });
    
    // Fallback: Listen for hash changes to checkout
    $(window).on('hashchange', function() {
        if (window.location.hash === '#checkout') {
            setTimeout(function() {
                loadCheckoutOrder();
            }, 100);
        }
    });
    
    // Handle Place Order button click
    $('#place-order-btn').on('click', function(e) {
        e.preventDefault();
        
        const $btn = $(this);
        const originalText = $btn.text();
        
        // Validate form (basic validation)
        if (!validateCheckoutForm()) {
            return;
        }
        
        // Disable button and show loading
        $btn.prop('disabled', true).html('<span class="spinner-border spinner-border-sm me-2" role="status"></span>Processing...');
        
        // Create order
        OrderService.createOrder(
            function(response) {
                // Success - show modal with order details
                showOrderSuccessModal(response.order);
                
                // Re-enable button
                $btn.prop('disabled', false).text(originalText);
                
                // Refresh checkout page to show empty cart
                setTimeout(function() {
                    loadCheckoutOrder();
                }, 1000);
            },
            function(error) {
                // Error - re-enable button
                $btn.prop('disabled', false).text(originalText);
                console.error('Order creation failed:', error);
            }
        );
    });
    
    // Handle Back to Store button click
    $(document).on('click', '#back-to-store-btn', function(e) {
        e.preventDefault();
        
        // Close the modal
        $('#orderSuccessModal').modal('hide');
        
        // Navigate to shop page and refresh
        setTimeout(function() {
            window.location.hash = '#shop';
            window.location.reload();
        }, 300); // Small delay to allow modal to close smoothly
    });
    
    function loadCheckoutOrder() {
        if (typeof CartService === 'undefined') {
            console.error('CartService not available');
            showEmptyOrder();
            return;
        }
        
        CartService.getCart(
            function(cart) {
                displayOrderItems(cart.items || []);
                updateOrderTotals(cart.items || []);
            },
            function(error) {
                console.error('Error loading cart for checkout:', error);
                showEmptyOrder();
            }
        );
    }
    
    function displayOrderItems(items) {
        const tbody = $('#checkout-order-items');
        
        console.log('displayOrderItems called with:', items);
        console.log('tbody found:', tbody.length);
        
        // Remove loading indicator
        $('#loading-order').remove();
        
        if (!items || items.length === 0) {
            console.log('No items found, showing empty order');
            showEmptyOrder();
            return;
        }
        
        console.log('Processing', items.length, 'items');
        
        // Remove any existing cart item rows (but keep subtotal/total rows)
        // The subtotal/total rows contain <td> elements with "font-weight-bold" class
        tbody.find('tr').each(function() {
            const $row = $(this);
            // Keep rows that contain <td> with "font-weight-bold" class (subtotal/total rows)
            if (!$row.find('td.font-weight-bold').length) {
                $row.remove();
            }
        });
        
        // Find the subtotal row (first row with font-weight-bold)
        const subtotalRow = tbody.find('tr:has(td.font-weight-bold)').first();
        console.log('Subtotal row found:', subtotalRow.length);
        
        items.forEach(function(item, index) {
            console.log('Processing item', index, ':', item);
            const price = parseFloat(item.price) || 0;
            const quantity = parseInt(item.quantity) || 1;
            const lineTotal = price * quantity;
            
            console.log('Item details - Price:', price, 'Quantity:', quantity, 'Total:', lineTotal);
            
            const itemRow = `
                <tr>
                    <td>${item.name} <strong class="mx-2">x</strong> ${quantity}</td>
                    <td>${CartService.formatPrice(lineTotal)}</td>
                </tr>
            `;
            
            console.log('Generated item row HTML:', itemRow);
            subtotalRow.before(itemRow);
        });
        
        console.log('Final tbody HTML:', tbody.html());
    }
    
    function updateOrderTotals(items) {
        const totals = CartService.calculateTotals(items);
        $('#checkout-subtotal').text(CartService.formatPrice(totals.subtotal));
        $('#checkout-total').text(CartService.formatPrice(totals.total));
    }
    
    function showEmptyOrder() {
        const tbody = $('#checkout-order-items');
        
        // Remove loading indicator
        $('#loading-order').remove();
        
        // Remove any existing cart item rows (but keep subtotal/total rows)
        tbody.find('tr').each(function() {
            const $row = $(this);
            // Keep rows that contain <td> with "font-weight-bold" class (subtotal/total rows)
            if (!$row.find('td.font-weight-bold').length) {
                $row.remove();
            }
        });
        
        // Find the subtotal row (first row with font-weight-bold)
        const subtotalRow = tbody.find('tr:has(td.font-weight-bold)').first();
        subtotalRow.before(`
            <tr>
                <td colspan="2" class="text-center py-3">
                    <p class="mb-0">Your cart is empty</p>
                    <a href="#shop" class="btn btn-primary btn-sm mt-2">Continue Shopping</a>
                </td>
            </tr>
        `);
        
        // Set totals to zero
        updateOrderTotals([]);
    }
    
    function validateCheckoutForm() {
        // Basic form validation
        const requiredFields = ['c_fname', 'c_lname', 'c_address', 'c_state_country', 'c_postal_zip', 'c_email_address', 'c_phone'];
        let isValid = true;
        
        requiredFields.forEach(function(fieldId) {
            const field = $('#' + fieldId);
            if (!field.val() || field.val().trim() === '') {
                field.addClass('is-invalid');
                isValid = false;
            } else {
                field.removeClass('is-invalid');
            }
        });
        
        // Validate country selection
        const country = $('#c_country');
        if (!country.val() || country.val() === '1') {
            country.addClass('is-invalid');
            isValid = false;
        } else {
            country.removeClass('is-invalid');
        }
        
        if (!isValid) {
            Utils.showError('Please fill in all required fields');
        }
        
        return isValid;
    }
    
    function showOrderSuccessModal(order) {
        if (!order) {
            console.error('No order data provided to success modal');
            return;
        }
        
        // Populate order details
        $('#order-id').text('#' + order.id);
        $('#order-status').text(OrderService.formatStatus(order.status));
        $('#order-total').text(OrderService.formatPrice(order.total_price));
        $('#order-date').text(OrderService.formatDate(order.created_at));
        
        // Populate order items
        const itemsList = $('#order-items-list');
        itemsList.empty();
        
        if (order.items && order.items.length > 0) {
            order.items.forEach(function(item) {
                const itemHtml = `
                    <div class="d-flex justify-content-between align-items-center border-bottom py-2">
                        <div>
                            <strong>${item.product_name}</strong>
                            <br>
                            <small class="text-muted">${item.brand}</small>
                        </div>
                        <div class="text-end">
                            <div>Qty: ${item.quantity}</div>
                            <div><strong>${OrderService.formatPrice(item.price_at_purchase * item.quantity)}</strong></div>
                        </div>
                    </div>
                `;
                itemsList.append(itemHtml);
            });
        } else {
            itemsList.html('<p class="text-muted">No items found</p>');
        }
        
        // Show the modal
        $('#orderSuccessModal').modal('show');
    }
});
</script>

		
